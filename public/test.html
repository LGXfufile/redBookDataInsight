<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APIæµ‹è¯•é¡µé¢</title>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px; 
      margin: 0 auto; 
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    button { 
      background: #667eea;
      color: white;
      border: none; 
      padding: 12px 24px; 
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
      font-size: 14px;
    }
    button:hover { background: #5a67d8; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    input, select { 
      padding: 8px 12px; 
      border: 1px solid #ddd; 
      border-radius: 4px;
      margin: 5px;
      width: 200px;
    }
    pre { 
      background: #f5f5f5; 
      padding: 15px; 
      border-radius: 6px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .loading { color: #667eea; font-weight: bold; }
    .error { color: #e53e3e; font-weight: bold; }
    .success { color: #38a169; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ å°çº¢ä¹¦éœ€æ±‚æ´å¯Ÿå·¥å…· - APIæµ‹è¯•</h1>
    
    <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
      <h3>ğŸ“Š æ•°æ®åˆ†ææµ‹è¯•</h3>
      <input type="text" id="keyword" placeholder="è¾“å…¥å…³é”®è¯ (å¦‚: æŠ¤è‚¤)" value="æŠ¤è‚¤">
      <label>
        <input type="checkbox" id="monitor"> å¼€å¯ç›‘æ§
      </label>
      <select id="frequency">
        <option value="2">æ¯2å°æ—¶</option>
        <option value="6" selected>æ¯6å°æ—¶</option>
        <option value="12">æ¯12å°æ—¶</option>
        <option value="24">æ¯24å°æ—¶</option>
      </select>
      <br>
      <button onclick="testAnalyze()" id="analyzeBtn">ğŸ” å¼€å§‹åˆ†æ</button>
    </div>

    <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
      <h3>ğŸ”” é£ä¹¦é€šçŸ¥æµ‹è¯•</h3>
      <p>Webhook: <code>https://open.feishu.cn/open-apis/bot/v2/hook/8d4df83a-07d0-48a2-83ac-cf8e3b163c3e</code></p>
      <button onclick="testFeishuNotification()">ğŸ“± å‘é€æµ‹è¯•é€šçŸ¥</button>
      <button onclick="testMonitorAlert()">ğŸš¨ å‘é€ç›‘æ§è­¦æŠ¥</button>
    </div>

    <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
      <h3>âš™ï¸ ç›‘æ§ç®¡ç†æµ‹è¯•</h3>
      <button onclick="testAddMonitor()">â• æ·»åŠ ç›‘æ§ä»»åŠ¡</button>
      <button onclick="testListMonitors()">ğŸ“‹ æŸ¥çœ‹ç›‘æ§åˆ—è¡¨</button>
      <button onclick="testRemoveMonitor()">âŒ ç§»é™¤ç›‘æ§ä»»åŠ¡</button>
    </div>

    <div>
      <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>
      <div id="result">ç­‰å¾…æµ‹è¯•...</div>
    </div>
  </div>

  <script>
    let currentTaskId = null;
    
    function setResult(content, type = 'info') {
      const result = document.getElementById('result');
      result.innerHTML = content;
      result.className = type;
    }

    async function testAnalyze() {
      const btn = document.getElementById('analyzeBtn');
      const keyword = document.getElementById('keyword').value;
      
      if (!keyword.trim()) {
        setResult('è¯·è¾“å…¥å…³é”®è¯ï¼', 'error');
        return;
      }

      btn.disabled = true;
      btn.textContent = 'ğŸ”„ åˆ†æä¸­...';
      setResult('æ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...', 'loading');

      try {
        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            keywords: [keyword],
            monitorEnabled: document.getElementById('monitor').checked,
            notifyFrequency: parseInt(document.getElementById('frequency').value)
          })
        });

        if (response.ok) {
          const data = await response.json();
          setResult(`âœ… åˆ†æå®Œæˆï¼

ğŸ“Š åˆ†æç»“æœï¼š
â€¢ å…³é”®è¯: ${data.keyword}
â€¢ æ€»å¸–å­æ•°: ${data.totalPosts}
â€¢ å‘ç°ç—›ç‚¹: ${data.painPoints.length} ä¸ª
â€¢ é«˜ä»·å€¼æœºä¼š: ${data.painPoints.filter(p => p.businessValue > 70).length} ä¸ª

ğŸ¯ ä¸»è¦ç—›ç‚¹ï¼š
${data.painPoints.slice(0, 5).map((p, i) => 
  `${i+1}. ${p.content} (ä»·å€¼:${p.businessValue}åˆ†)`
).join('\n')}

ğŸ“ˆ è¶‹åŠ¿æ•°æ®: ${data.trends.length} ä¸ªæ•°æ®ç‚¹`, 'success');
        } else {
          const error = await response.text();
          setResult(`âŒ åˆ†æå¤±è´¥: ${error}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸ” å¼€å§‹åˆ†æ';
      }
    }

    async function testFeishuNotification() {
      setResult('ğŸ”„ å‘é€é£ä¹¦æµ‹è¯•é€šçŸ¥...', 'loading');
      
      const webhookUrl = 'https://open.feishu.cn/open-apis/bot/v2/hook/8d4df83a-07d0-48a2-83ac-cf8e3b163c3e';
      
      try {
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            msg_type: 'text',
            content: {
              text: `ğŸ‰ å°çº¢ä¹¦éœ€æ±‚æ´å¯Ÿå·¥å…· - è¿æ¥æµ‹è¯•

æ—¶é—´: ${new Date().toLocaleString('zh-CN')}
çŠ¶æ€: âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸

ğŸ” åŠŸèƒ½éªŒè¯ï¼š
â€¢ å‰ç«¯ç•Œé¢: æ­£å¸¸åŠ è½½
â€¢ APIæ¥å£: è¿æ¥æˆåŠŸ
â€¢ æ•°æ®åˆ†æ: åŠŸèƒ½æ­£å¸¸
â€¢ é€šçŸ¥ç³»ç»Ÿ: æµ‹è¯•æˆåŠŸ

ğŸ’¡ æ‚¨çš„å°çº¢ä¹¦ç—›ç‚¹ç›‘æ§å·¥å…·å·²å°±ç»ªï¼`
            }
          })
        });

        if (response.ok) {
          setResult('âœ… é£ä¹¦é€šçŸ¥å‘é€æˆåŠŸï¼è¯·æŸ¥çœ‹ç¾¤æ¶ˆæ¯', 'success');
        } else {
          setResult(`âŒ é£ä¹¦é€šçŸ¥å‘é€å¤±è´¥: ${response.status}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ å‘é€å¤±è´¥: ${error.message}`, 'error');
      }
    }

    async function testMonitorAlert() {
      setResult('ğŸ”„ å‘é€ç›‘æ§è­¦æŠ¥...', 'loading');
      
      const webhookUrl = 'https://open.feishu.cn/open-apis/bot/v2/hook/8d4df83a-07d0-48a2-83ac-cf8e3b163c3e';
      
      try {
        const response = await fetch(webhookUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            msg_type: 'text',
            content: {
              text: `ğŸš¨ ç—›ç‚¹ç›‘æ§è­¦æŠ¥ - å‘ç°å•†ä¸šæœºä¼šï¼

å…³é”®è¯: ç›‘æ§é€šçŸ¥
æ—¶é—´: ${new Date().toLocaleString('zh-CN')}

å‘ç° 3 ä¸ªæ–°ç—›ç‚¹ï¼Œå…¶ä¸­ 2 ä¸ªé«˜ä»·å€¼æœºä¼šï¼š

1. é€šçŸ¥å“åº”é€Ÿåº¦å¤ªæ…¢
   ğŸ”¥ å•†ä¸šä»·å€¼: 85åˆ†
   ğŸ“Š æåŠé¢‘æ¬¡: 23æ¬¡

2. ç¼ºå°‘ä¸ªæ€§åŒ–è®¾ç½®
   ğŸ”¥ å•†ä¸šä»·å€¼: 72åˆ†  
   ğŸ“Š æåŠé¢‘æ¬¡: 15æ¬¡

3. ç•Œé¢ä¸å¤Ÿç¾è§‚
   ğŸ”¥ å•†ä¸šä»·å€¼: 68åˆ†
   ğŸ“Š æåŠé¢‘æ¬¡: 12æ¬¡

ğŸ’¼ å»ºè®®ç«‹å³å…³æ³¨è¿™äº›å¸‚åœºæœºä¼šï¼`
            }
          })
        });

        if (response.ok) {
          setResult('âœ… ç›‘æ§è­¦æŠ¥å‘é€æˆåŠŸï¼è¯·æŸ¥çœ‹ç¾¤æ¶ˆæ¯', 'success');
        } else {
          setResult(`âŒ ç›‘æ§è­¦æŠ¥å‘é€å¤±è´¥: ${response.status}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ å‘é€å¤±è´¥: ${error.message}`, 'error');
      }
    }

    async function testAddMonitor() {
      setResult('ğŸ”„ åˆ›å»ºç›‘æ§ä»»åŠ¡...', 'loading');
      currentTaskId = `task_${Date.now()}`;
      
      try {
        const response = await fetch('/api/monitor', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add',
            taskId: currentTaskId,
            config: {
              webhookUrl: 'https://open.feishu.cn/open-apis/bot/v2/hook/8d4df83a-07d0-48a2-83ac-cf8e3b163c3e',
              keywords: ['ç›‘æ§é€šçŸ¥'],
              frequency: 6
            }
          })
        });

        if (response.ok) {
          const data = await response.json();
          setResult(`âœ… ç›‘æ§ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼
          
ä»»åŠ¡ID: ${currentTaskId}
å…³é”®è¯: ç›‘æ§é€šçŸ¥
é¢‘ç‡: æ¯6å°æ—¶
çŠ¶æ€: è¿è¡Œä¸­`, 'success');
        } else {
          const error = await response.text();
          setResult(`âŒ åˆ›å»ºå¤±è´¥: ${error}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
      }
    }

    async function testListMonitors() {
      setResult('ğŸ”„ è·å–ç›‘æ§åˆ—è¡¨...', 'loading');
      
      try {
        const response = await fetch('/api/monitor', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'list' })
        });

        if (response.ok) {
          const data = await response.json();
          if (data.tasks && data.tasks.length > 0) {
            const taskList = data.tasks.map((task, index) => 
              `${index + 1}. ID: ${task.id}
   å…³é”®è¯: ${task.config.keywords.join(', ')}
   é¢‘ç‡: æ¯${task.config.frequency}å°æ—¶`
            ).join('\n\n');
            
            setResult(`âœ… ç›‘æ§ä»»åŠ¡åˆ—è¡¨ (${data.tasks.length}ä¸ª)ï¼š

${taskList}`, 'success');
          } else {
            setResult('ğŸ“‹ æš‚æ— ç›‘æ§ä»»åŠ¡', 'info');
          }
        } else {
          const error = await response.text();
          setResult(`âŒ è·å–å¤±è´¥: ${error}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
      }
    }

    async function testRemoveMonitor() {
      if (!currentTaskId) {
        setResult('âŒ è¯·å…ˆåˆ›å»ºç›‘æ§ä»»åŠ¡', 'error');
        return;
      }
      
      setResult('ğŸ”„ ç§»é™¤ç›‘æ§ä»»åŠ¡...', 'loading');
      
      try {
        const response = await fetch('/api/monitor', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'remove',
            taskId: currentTaskId
          })
        });

        if (response.ok) {
          setResult(`âœ… ç›‘æ§ä»»åŠ¡å·²ç§»é™¤: ${currentTaskId}`, 'success');
          currentTaskId = null;
        } else {
          const error = await response.text();
          setResult(`âŒ ç§»é™¤å¤±è´¥: ${error}`, 'error');
        }
      } catch (error) {
        setResult(`âŒ ç§»é™¤å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    window.onload = function() {
      setResult(`ğŸ¯ å°çº¢ä¹¦éœ€æ±‚æ´å¯Ÿå·¥å…·æµ‹è¯•é¡µé¢

ğŸ“‹ åŠŸèƒ½æ¸…å•ï¼š
âœ… Vue3 + TypeScript å‰ç«¯æ¡†æ¶  
âœ… Element Plus UIç»„ä»¶åº“
âœ… ECharts æ•°æ®å¯è§†åŒ–
âœ… Vercel Functions åç«¯API
âœ… æ™ºèƒ½çˆ¬è™«å’ŒNLPåˆ†æ
âœ… é£ä¹¦æœºå™¨äººé€šçŸ¥ç³»ç»Ÿ
âœ… å®šæ—¶ç›‘æ§ä»»åŠ¡ç®¡ç†

ğŸš€ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½ï¼`, 'info');
    };
  </script>
</body>
</html>